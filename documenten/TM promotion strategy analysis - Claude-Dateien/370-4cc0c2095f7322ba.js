"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[370],{2722:(e,t,n)=>{n.d(t,{S:()=>f,v:()=>m});var r=n(54568),s=n(23812),a=n(84617),i=n(98304),o=n(17560),l=n(27541),u=n(39214),c=n(59666),d=n(66912);function m(e){let{isOpen:t,onClose:n,limitType:m="projects",customTitle:f,customDescription:g}=e,p=(0,l.useRouter)(),h=["opus"===m?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:"message_limit"===m?{defaultMessage:"Access to tools like research and web search",id:"message_limit_benefit_tools"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===m&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===m&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},"message_limit"===m&&{defaultMessage:"Claude Code directly in your terminal",id:"message_limit_benefit_code"},"message_limit"===m&&{defaultMessage:"Integration to Google Workspace: email, calendar, and docs",id:"message_limit_benefit_workspace"},"message_limit"===m&&{defaultMessage:"Full access to the newest Claude models including Opus",id:"message_limit_benefit_models"},"message_limit"===m&&{defaultMessage:"Extended thinking for complex work",id:"message_limit_benefit_thinking"},"message_limit"!==m&&{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},"message_limit"!==m&&{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},"message_limit"!==m&&{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},"message_limit"!==m&&{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,r.jsx)(u.bL,{open:t,onOpenChange:n,children:(0,r.jsx)(u.ZL,{children:(0,r.jsx)(u.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,r.jsxs)(u.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),n()},onInteractOutside:e=>{e.preventDefault(),n()},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,r.jsx)(d.M,{}),(0,r.jsx)(u.bm,{asChild:!0,children:(0,r.jsx)(s.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,r.jsx)(i.X,{size:20,weight:"regular"})})})]}),(0,r.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,r.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:f||("opus"===m?(0,r.jsx)(c.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):"message_limit"===m?(0,r.jsx)(c.A,{defaultMessage:"Keep chatting with Claude",id:"u3sKHTmxou"}):(0,r.jsx)(c.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,r.jsx)("p",{className:"".concat("message_limit"===m?"text-sm":"text-base"," text-text-300 mb-3"),children:g||("opus"===m?(0,r.jsx)(c.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):"message_limit"===m?(0,r.jsx)(c.A,{defaultMessage:"You just hit your free message limit. Upgrade to Pro (or Max) to send more messages. You also get:",id:"vXAAoQRvRg"}):(0,r.jsx)(c.A,{defaultMessage:"Free plans only get access to one Project. Upgrade now to get:",id:"NOiyw9Bber"}))}),(0,r.jsx)("div",{className:"space-y-1.5 mb-6",children:h.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)(o.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,r.jsx)("span",{className:"text-sm text-text-200",children:(0,r.jsx)(c.A,{...e})})]},"benefit-".concat(t)))}),("opus"===m||"projects"===m)&&(0,r.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,r.jsx)(a.Y,{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(c.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,r.jsx)(s.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{n(),p.push("/upgrade")},children:(0,r.jsx)(c.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let f=m},4114:(e,t,n)=>{n.d(t,{p:()=>i});var r=n(18088),s=n(68067),a=n(56706);let i=()=>{let e=(0,s.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,a.O5)(),i=(null==t?void 0:t.defaultStyles)||[],o=[...i,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[l,u,c]=(0,r.Vc)("claude_personalized_style",null);if(n||!(null==o?void 0:o.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let d=i.length?i.find(e=>!0===e.isDefault)||i[0]:null;if(e&&(d=i.find(e=>"Concise"===e.key)||d),!l)return{personalizedStyleOptions:o,defaultStyle:d,storedStyle:l,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let m=o.find(e=>((e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t)(e,l.styleKey)),f=Date.now()-new Date(l.timestamp).getTime()>432e5;return{personalizedStyleOptions:o,storedStyle:m&&!f?m:null,defaultStyle:d,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e}}},15774:(e,t,n)=>{n.d(t,{m:()=>r});function r(e,t){if(t.length>0)return!0;let n=e.filter(e=>"env_manager_log"!==e.type),r=n[n.length-1];return!r||"result"!==r.type}},17421:(e,t,n)=>{n.d(t,{$D:()=>h,I5:()=>v,LL:()=>k,Lb:()=>b,Ly:()=>E,QJ:()=>p,ct:()=>T,eG:()=>S,gn:()=>y,oz:()=>_,pC:()=>w,ts:()=>A});var r=n(74813),s=n(1613),a=n(64328),i=n(80688),o=n(68067),l=n(8019),u=n(65738),c=n(4869),d=n(7620),m=n(24407),f=n(74172),g=n(15774);function p(){return(0,o.fS)("yukon_gold")}let h=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,a.YL)(),r=null==n?void 0:n.uuid;return(0,s.Sk)("/v1/sessions",{queryKey:[i.Rv,{orgUuid:r}],enabled:!!n&&e,staleTime:3e4,refetchInterval:t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...r?{"x-organization-uuid":r}:{}}})};function v(e,t){return{uuid:(0,l.b)(),session_id:t,type:"user",parent_tool_use_id:null,message:{role:"user",content:e}}}let y=e=>{let{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid;return(0,s.Sk)("/v1/sessions/".concat(e),{queryKey:[i.Ex,{orgUuid:n,sessionId:e}],enabled:!!t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})};function b(e){let t=(0,o.T9)("bad_moon_rising_config","environment_id","",m.z.string()),n=(0,o.T9)("bad_moon_rising_prompt","main",void 0,m.z.string().nullable().optional()),r=(0,o.T9)("ccr_model","model","claude-sonnet-4-20250514",m.z.string()),s=_();return(0,d.useCallback)(a=>{let i;if(n){let e=new Date().toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"});i=n.replaceAll("{{currentDateTime}}",e)}return s({...a,environmentId:t,model:"session"===e?a.model:r,customPrompt:"session"===e?i:void 0,mcpConfig:a.mcpServers?{mcpServers:a.mcpServers}:void 0})},[t,s,r,n,e])}function _(){let e=x();return(0,d.useCallback)(t=>{let{initialMessage:n,title:r,customPrompt:s,model:a,gitRepoUrl:i,gitBranch:o,environmentId:l,mcpConfig:u}=t,c=[];n&&c.push({type:"event",data:n});let d=[],m=[];return i&&o&&(d.push({type:"git_repository",url:i}),m.push({type:"git_repository",git_info:{type:"github",repo:i.split("github.com/")[1],branches:[o]}})),e.mutateAsync({title:r,events:c,environment_id:l,session_context:{sources:d,outcomes:m,mcp_config:u,...void 0!==s?{custom_system_prompt:s}:{},...void 0!==a?{model:a}:{}}})},[e])}let x=()=>{let{activeOrganization:e}=(0,a.YL)(),t=(0,c.useQueryClient)(),{track:n}=(0,r.st)(),o=null==e?void 0:e.uuid;return(0,s.L2)("/v1/sessions","POST",{onSuccess:e=>{t.invalidateQueries({queryKey:[i.Rv,{orgUuid:o}]}),n({event_key:"claudeai.yukon_gold.session_created",session_id:e.id})},meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...o?{"x-organization-uuid":o}:{}}})};function S(){let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid;return(0,s.L2)("/api/organizations/".concat(t,"/dust/generate_title_and_branch"),"POST")}function k(){let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid;return(0,s.L2)("/api/organizations/".concat(t,"/dust/generate_session_title"),"POST")}function w(){let{activeOrganization:e}=(0,a.YL)(),t=(0,c.useQueryClient)(),n=null==e?void 0:e.uuid;return(0,s.L2)(e=>"/v1/sessions/".concat(e.sessionId,"/archive"),"POST",{transformVariables:()=>({}),onSuccess:(e,r)=>{t.invalidateQueries({queryKey:[i.Rv,{orgUuid:n}]}),t.invalidateQueries({queryKey:[i.Ex,{orgUuid:n,sessionId:r.sessionId}]})},meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})}let M=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="/v1/sessions/ws/".concat(t,"/subscribe"),s=new URLSearchParams;s.append("organization_uuid",e),n.replay&&s.append("replay","true");let a=s.toString();a&&(r+="?".concat(a));let i="https:"===window.location.protocol?"wss:":"ws:";return"".concat(i,"//").concat(window.location.host).concat(r)},C=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,a.YL)(),r=null==n?void 0:n.uuid;return(0,s.Sk)("/v1/sessions/".concat(e,"/events"),{queryKey:[i.ri,{orgUuid:r,sessionId:e}],enabled:!!n&&t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...r?{"x-organization-uuid":r}:{}}})};class P{[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((e,t)=>{this.readResolve=e,this.readReject=t})}enqueue(e){if(this.readResolve){let t=this.readResolve;this.readResolve=void 0,this.readReject=void 0,t({done:!1,value:e})}else this.queue.push(e)}done(){if(this.isDone=!0,this.readResolve){let e=this.readResolve;this.readResolve=void 0,this.readReject=void 0,e({done:!0,value:void 0})}}error(e){if(this.hasError=e,this.readReject){let t=this.readReject;this.readResolve=void 0,this.readReject=void 0,t(e)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}constructor(e){this.returned=e,this.queue=[],this.isDone=!1,this.started=!1}}function T(e,t,n,r){let{data:s,isLoading:o,refetch:m}=C(e,!0),{streamedMessages:p,interrupt:h,inputStreamRef:v,ensureConnected:y,connectionState:b,lastMessageTime:_}=function(e,t,n,r,s){let o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],l=!(arguments.length>6)||void 0===arguments[6]||arguments[6],m=(0,d.useRef)(null),p=(0,d.useRef)(null),h=(0,d.useRef)(!1),v=(0,d.useRef)(0),y=(0,d.useRef)(null),b=(0,d.useRef)(null),_=(0,d.useRef)(null),[x,S]=(0,d.useState)([]),[k,w]=(0,d.useState)("disconnected"),[C,T]=(0,d.useState)(null),A=(0,f.Tk)(e),E=(0,d.useRef)(e),z=(0,d.useCallback)(()=>{h.current=!0,w("disconnected"),T(null),y.current&&(clearTimeout(y.current),y.current=null),p.current&&(p.current.abort(),p.current=null),_.current&&(_.current.done(),_.current=null),m.current=null,b.current=null,v.current=0},[]);(0,d.useEffect)(()=>{E.current!==e&&(z(),S([]),w("disconnected"),T(null),v.current=0,E.current=e)},[e,z]);let{activeOrganization:L}=(0,a.YL)(),R=null==L?void 0:L.uuid,I=(0,c.useQueryClient)(),U=(0,d.useRef)(s);U.current=s;let O=(0,d.useCallback)(()=>{var t;if(!o||!R||!e||m.current&&b.current===e)return;z(),h.current=!1,w("connecting"),b.current=e,p.current=new AbortController,_.current=new P;let s=(0,u.P)({prompt:_.current,websocket:{url:M(R,e)},abortController:p.current,mcpServers:r,canUseTool:U.current?(t=U.current,async(e,n)=>{let[r,s,a]=e.split("__");if("mcp"!==r||!s||!a)return{behavior:"deny",message:"Invalid tool name format"};let i=await t(e,n);return j(e,n,i)}):void 0}),a=null;(async()=>{var e,t,n;try{let n=new Map,r=!0;for await(let o of(a=setTimeout(()=>{r&&w("connected")},500),s)){if(r&&(r=!1,clearTimeout(a),v.current=0,w("connected")),T(Date.now()),S(e=>o.uuid&&e.some(e=>e.uuid===o.uuid)?e:[...e,o]),"assistant"===o.type&&"message"in o){let t=null==(e=o.message)?void 0:e.content;if(Array.isArray(t))for(let e of t)"tool_use"===e.type&&e.id&&e.name&&n.set(e.id,{name:e.name,id:e.id,input:e.input})}if("user"===o.type&&"message"in o){let e=null==(t=o.message)?void 0:t.content;if(Array.isArray(e)){for(let t of e)if("tool_result"===t.type&&t.tool_use_id){let e=n.get(t.tool_use_id),r=(null==e?void 0:e.name)==="mcp__git__git_push",s=(null==e?void 0:e.name)==="Bash"&&function(e){if(!e||"object"!=typeof e)return!1;let t=e.command;return"string"==typeof t&&/^\s*git\s+push\b/.test(t)}(e.input);(r||s)&&I.invalidateQueries({queryKey:[i.uh],refetchType:"all"})}}}}}catch(r){a&&clearTimeout(a);let e=h.current,t=null==(n=p.current)?void 0:n.signal.aborted;if(h.current=!1,m.current===s&&(w("disconnected"),m.current=null),l&&!e&&!t&&r instanceof Error&&"WebSocket connection aborted by user"!==r.message){let e=v.current;if(e<5){v.current=e+1;let t=1e3*Math.pow(2,e),n=Math.random()*t*.5;y.current=setTimeout(()=>{O()},t+n)}}}})(),n(e=>{var t;null==(t=_.current)||t.enqueue(e)}),m.current=s},[o,R,e,z,n,l,r,I]);return(0,d.useEffect)(()=>()=>z(),[z]),(0,d.useEffect)(()=>{if(!C||"connected"!==k||(0,g.m)(x,A))return;let e=3e5-(Date.now()-C);if(e<=0)return void z();let t=setTimeout(()=>{z()},e);return()=>{clearTimeout(t)}},[C,k,x,A,z]),{streamedMessages:x,interrupt:(0,d.useCallback)(()=>{m.current&&(h.current=!0,m.current.interrupt())},[]),inputStreamRef:_,ensureConnected:(0,d.useCallback)(()=>{m.current||(v.current=0,O())},[O]),connectionState:k,lastMessageTime:C}}(e,t,(0,d.useCallback)(e=>{let t=m();return R.current.forEach(t=>{e(t)}),t},[m]),n,r),x=(0,f.Tk)(e),S=(0,f.jT)(),k=(0,f.Ou)(e=>e.removePendingMessage),w=(0,f.Ou)(e=>e.clearPendingMessages),T=(0,d.useMemo)(()=>{if(o||!s)return[];let e=new Set;return s.data.filter(t=>!(!t.uuid||e.has(t.uuid))&&(e.add(t.uuid),!0))},[o,s]),A=(0,d.useMemo)(()=>{let t=new Map;for(let e of T)e.uuid&&t.set(e.uuid,e);for(let e of p)e.uuid&&t.set(e.uuid,e);for(let n of t.keys())k(e,n);return Array.from(t.values())},[T,p,e,k]),E=(0,d.useCallback)(t=>{var n;let r={uuid:(0,l.b)(),type:"user",session_id:e,parent_tool_use_id:null,message:{role:"user",content:t}};S(e,r),null==(n=v.current)||n.enqueue(r)},[S,e,v]),z=(0,d.useCallback)((e,t,n)=>{var r;let s={type:"control_response",response:{subtype:"success",request_id:e,response:j(e,t,n)}};null==(r=v.current)||r.enqueue(s)},[v]),L=(0,d.useMemo)(()=>{if(0===x.length)return[];let e=new Set;for(let t of A)e.add(t.uuid);return x.filter(t=>!e.has(t.uuid))},[x,A]),R=(0,d.useRef)([]);R.current=L,(0,d.useEffect)(()=>{L.length>0&&y()},[y,L.length]);let I=(0,d.useCallback)(()=>{h(),w(e)},[h,w,e]),U=(0,d.useCallback)(()=>{h(),setTimeout(()=>{y()},100)},[h,y]);return{loadingInitialMessages:o,sendMessage:E,sendToolDecision:z,stopSession:I,eventsMessages:null==s?void 0:s.data,messages:A,pendingMessages:L,ensureConnected:y,connectionState:b,lastMessageTime:_,retry:U}}function j(e,t,n){let r;return"deny"===n?{behavior:"deny",message:"Denied by user"}:("always"===n&&(r=[{type:"replaceRules",rules:[{toolName:e}],behavior:"allow",destination:"localSettings"}]),{behavior:"allow",updatedInput:t,updatedPermissions:r})}function A(){let{activeOrganization:e}=(0,a.YL)(),t=(0,s.L2)("/api/organizations/".concat(null==e?void 0:e.uuid,"/sessions"),"POST",{enabled:!!e});return(0,d.useCallback)(e=>{let n=[];return e&&n.push({type:"event",data:e}),t.mutateAsync({title:"",config_id:"yukon_gold",events:n})},[t])}function E(){return(0,o.fS)("gashadokuro")}},27125:(e,t,n)=>{n.d(t,{TA:()=>d,_x:()=>c,eI:()=>u,p9:()=>l});var r=n(39613),s=n(13296),a=n(73356);let i="enabled",o="".concat(r.sn,".statsig.");function l(e){return"".concat(o).concat(e)}function u(e,t,n,r){let o=l(e),u=null!=r?r:t(e,n);try{u?(0,s.ul)().setItem(o,i):(0,s.ul)().setItem(o,"disabled")}catch(t){a.v.warn(a.u.LOCAL_STORAGE,"[persistValue failed]:",{name:e,label:o,error:t})}}function c(e,t,n){let r=l(e);if((0,s.ul)().getItem(r)===i)return!0;let a=t(e,n);return u(e,t,n,a),a}function d(e,t){if(t)for(let n of Object.keys((0,s.ul)()).filter(e=>e.startsWith(o)).map(e=>e.replace(o,"")))u(n,e,t,e(n,t))}},52135:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(68067),s=n(27736),a=n(7620),i=n(96614),o=n(86545);let l=()=>{let e="sticky-model-selector",t=(0,r.fS)("sticky_model_selector"),n=(0,r.fS)("model_selector_enabled"),{activeModelOptions:l}=(0,o.A9)(),u=(0,i.Z3)(null),c=(0,s.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===u?null:r&&l.find(e=>e.model===r)?r:null},initialData:null}),d=(0,a.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},55188:(e,t,n)=>{n.d(t,{S:()=>m,r:()=>f});var r=n(54568),s=n(74813),a=n(39613),i=n(99969),o=n.n(i),l=n(27541),u=n(7620),c=n(24443);let d=u.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:o(),temporaryConversationUuid:null,setTemporaryConversationUuid:o()}),m=()=>u.useContext(d),f=e=>{let{children:t}=e,n=(0,s.st)(),i=(0,l.useRouter)(),o=(0,l.useSearchParams)(),m=(0,c.I_)(),f=o.has(a.cn),[g,p]=(0,u.useState)(f),h=(0,u.useRef)(g),[v,y]=(0,u.useState)(null);(0,u.useEffect)(()=>{h.current=g},[g]),(0,u.useEffect)(()=>{f&&!g&&p(!0)},[f,g]);let b=(0,u.useCallback)(e=>{if(p(e),e)i.push("?".concat(a.cn));else{y(null);let e=new URLSearchParams(o.toString());e.delete(a.cn);let t=e.toString();i.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}n.track({event_key:"claudeai.incognito_mode.toggled",enabled:e})},[i,o,n]);(0,u.useEffect)(()=>{h.current&&!f&&b(!1)},[b,f]);let _=(0,u.useMemo)(()=>({incognitoModeEnabled:!!m&&g,setIncognitoModeEnabled:b,temporaryConversationUuid:m?v:null,setTemporaryConversationUuid:y}),[g,b,v,y,m]);return(0,r.jsx)(d.Provider,{value:_,children:t})}},55442:(e,t,n)=>{n.d(t,{PerformanceMetricsProvider:()=>x,B:()=>S});var r=n(54568),s=n(73356);class a extends Error{}class i{add(e){this.buffer[this.head]=e,this.head=(this.head+1)%this.maxSize,this.currentSize<this.maxSize&&this.currentSize++}addAll(e){for(let t of e)this.add(t)}flush(){this.head=0,this.currentSize=0,this.buffer=Array(this.maxSize)}get size(){return this.currentSize}get isEmpty(){return 0===this.currentSize}get isFull(){return this.currentSize===this.maxSize}*values(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;for(let t=0;t<this.currentSize;t++){let n=(e+t)%this.maxSize;yield this.buffer[n]}}toArray(){return Array.from(this.values())}getLast(){if(0===this.currentSize)return;let e=(this.head-1+this.maxSize)%this.maxSize;return this.buffer[e]}getFirst(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;return this.buffer[e]}constructor(e){if(this.maxSize=e,this.head=0,this.currentSize=0,e<1)throw new a("RingBuffer maxSize must be 1 or more");this.buffer=Array(e)}}var o=n(99731),l=n(42248);class u{get mean(){return this.count>0?this._mean:0}get variance(){return this.count>1?this._m2/(this.count-1):0}get stdDev(){return Math.sqrt(this.variance)}calculate(){let e=this._tail-this._mean;this._mean+=e/this.count;let t=this._tail-this._mean;this._m2+=e*t}getSummary(){return{count:this.count,sum:this.sum,min:this.min,max:this.max,mean:this.mean,variance:this.variance,stdDev:this.stdDev}}reset(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._mean=0,this._m2=0}add(e){this.count+=1,this.sum+=e,this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this._tail=e,this.calculate()}constructor(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._tail=0,this._mean=0,this._m2=0,this.reset()}}class c{init(){if(this.shouldReportMemory=(0,o.Y)(),"PerformanceLongTaskTiming"in window)try{this.events.longTask.observer=this.initLongTaskObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon LongTaskObserver failed to init")}if("PerformanceEventTiming"in window)try{this.events.inputDelay.observer=this.initInputDelayObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon EventTimingObserver failed to init")}if("PerformanceLongAnimationFrameTiming"in window)try{this.events.longAnimationFrame.observer=this.initLongAnimationFrameObserver()}catch(e){s.v.error(s.u.O11Y_INTERNALS,"PerfMon EventTimingObserver failed to init")}this.startReportMetricsInterval(),this.registerVisibilityHandlers()}initLongTaskObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let{attribution:e}=n;if(this.events.longTask.stats.add(n.duration),n.duration>=250){var t;this.events.longTask.buffer.add({start_time:n.startTime,duration_ms:n.duration,attribution_count:null!=(t=null==e?void 0:e.length)?t:0})}}});return e.observe({entryTypes:["longtask"]}),e}initInputDelayObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let e=n.processingStart?n.processingStart-n.startTime:0;if(e>100){this.events.inputDelay.stats.add(n.duration);let r=Number(n.processingEnd)-Number(n.processingStart);if(e>250||r>250){var t;this.events.inputDelay.buffer.add({start_time:n.startTime,duration_ms:e,processing_duration_ms:r,inp_duration_ms:n.duration,event_name:n.name,event_target_id:(null==(t=n.target)?void 0:t.id)||"unknown_target",is_fid:"first-input"===n.entryType})}}}});return e.observe({entryTypes:["event","first-input"]}),e}initLongAnimationFrameObserver(){let e=new PerformanceObserver(e=>{for(let t of e.getEntries()){let{blockingDuration:e}=t;if(this.events.longAnimationFrame.stats.add(t.duration),t.duration>=250){let n={start_time:t.startTime,duration_ms:t.duration,blocking_duration_ms:e||0};this.events.longAnimationFrame.buffer.add(n)}}});return e.observe({entryTypes:["long-animation-frame"]}),e}startReportMetricsInterval(){let e=()=>{this.reportMetricsTimeoutId=window.setTimeout(()=>{this.reportMetrics(),this.isActive&&e()},12e4)};e()}registerVisibilityHandlers(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.reportMetrics()},{passive:!0}),window.addEventListener("pagehide",()=>this.reportMetrics(),{passive:!0})}reportMetrics(){this.isActive&&(this.shouldReportMemory&&(0,l.r)("events.memory_snapshot",{metricType:"memory_snapshot"}),Object.values(this.events).forEach(e=>{let{name:t,stats:n,buffer:r}=e;0!==n.mean&&((0,l.r)("events.".concat(t,".summary"),{metricType:"".concat(t,"_summary"),performanceAttributes:{...n.getSummary()}}),r.toArray().forEach(e=>{let{duration_ms:n,...r}=e;(0,l.r)("events.".concat(t),{metricType:"".concat(t,"_event"),duration:n,performanceAttributes:{...r}})}),n.reset(),r.flush())}))}destroy(){this.isActive=!1,Object.values(this.events).forEach(e=>{var t;null==(t=e.observer)||t.disconnect(),e.observer=void 0}),clearTimeout(this.reportMetricsTimeoutId),this.reportMetricsTimeoutId=void 0,this.reportMetrics()}forceReport(){this.reportMetrics()}constructor(){this.isActive=!0,this.shouldReportMemory=!1,this.events={longTask:{name:"long_task",stats:new u,buffer:new i(100)},inputDelay:{name:"input_delay",stats:new u,buffer:new i(100)},longAnimationFrame:{name:"loaf",stats:new u,buffer:new i(100)}},this.init()}}var d=n(24024);class m{initPerfMon(){this.perfMon||(this.perfMon=new c)}trackNewChatInputReady(e){(0,l.r)("page.new_chat_input_ready",{duration:e.duration,attributes:{is_first_load:e.isFirstLoad,is_prog_chat_input:e.isProgChatInput,prog_chat_input_perf_mark_missing:e.progChatInputPerfMarkMissing}}),d.C.clearParentContext()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};t.model&&(n["chat.model"]=t.model),t.integrations&&(n["chat.integrations"]=t.integrations),(0,l.r)("chat.time_to_first_token",{metricType:"ttft",duration:e,attributes:n})}trackProjectConversationsReady(e){(0,l.r)("page.project_conversations_ready",{duration:e})}trackMembersListReady(e){(0,l.r)("page.members_list_ready",{duration:e})}constructor(){this.perfMon=null}}let f=new m;var g=n(13296),p=n(27541),h=n(7620),v=n(27125);let y="prog_chat_input_ready",b=(0,v.p9)("prog_chat_input"),_=(0,h.createContext)(null);function x(e){let{children:t}=e,n=(0,p.usePathname)(),s=(0,h.useRef)(!0),a=(0,h.useRef)(null),i=(0,h.useRef)(!1),o=(0,h.useRef)(null),l=(0,h.useRef)(!1),u=(0,h.useRef)(null),c=(0,h.useRef)(!1),d=(0,h.useRef)(null),m=(0,h.useRef)(!1);(0,h.useEffect)(()=>{f.initPerfMon()},[]),(0,h.useEffect)(()=>{"/new"===n?(a.current=s.current?0:performance.now(),i.current=!1):(null==n?void 0:n.startsWith("/project/"))?(u.current=performance.now(),c.current=!1):"/settings/members"===n&&(d.current=performance.now(),m.current=!1),s.current=!1},[n]);let v=(0,h.useCallback)(()=>{if(i.current||null===a.current)return;i.current=!0;let e=0===a.current,{duration:t,isProgChatInput:n,progChatInputPerfMarkMissing:r}=function(e,t){let n,r=performance.getEntriesByName(y,"mark")[0],s="enabled"===(0,g.ul)().getItem(b),a=!1;return r&&t?(n=r.startTime,performance.clearMarks(y)):(n=performance.now()-e,s&&t&&(a=!0)),{duration:n,isProgChatInput:s,progChatInputPerfMarkMissing:a}}(a.current,e);f.trackNewChatInputReady({duration:t,isFirstLoad:e,isProgChatInput:n,progChatInputPerfMarkMissing:r}),a.current=null},[]),x=(0,h.useCallback)(()=>{o.current=performance.now(),l.current=!1},[]),S=(0,h.useCallback)(e=>{if(null===o.current||l.current)return;l.current=!0;let t=performance.now()-o.current;f.trackTTFT(t,e),o.current=null},[]),k=(0,h.useCallback)(()=>{if(c.current||null===u.current)return;c.current=!0;let e=performance.now()-u.current;f.trackProjectConversationsReady(e),u.current=null},[]),w=(0,h.useCallback)(()=>{if(m.current||null===d.current)return;m.current=!0;let e=performance.now()-d.current;f.trackMembersListReady(e),d.current=null},[]),M=(0,h.useMemo)(()=>({markEditorReady:v,markMessageSent:x,markFirstTokenReceived:S,markProjectConversationsReady:k,markMembersListReady:w}),[v,x,S,k,w]);return(0,r.jsx)(_.Provider,{value:M,children:t})}function S(){let e=(0,h.useContext)(_);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},56706:(e,t,n)=>{n.d(t,{M$:()=>c,O5:()=>o,f$:()=>l,lo:()=>u,n7:()=>d});var r=n(1613),s=n(64328),a=n(80688),i=n(4869);let o=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[a.ss,{orgUuid:t}]})},l=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=(0,i.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[a.ss,{orgUuid:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,s.YL)(),o=null==n?void 0:n.uuid,l=(0,i.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(o,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.ss,{orgUuid:o}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,o=(0,i.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{o.invalidateQueries({queryKey:[a.ss,{orgUuid:n}]})}})},d=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},59074:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>l,T:()=>o});var r=n(54568),s=n(7620),a=n(2722);let i=null;function o(){i&&i(!0)}function l(){let[e,t]=(0,s.useState)(!1);return(0,s.useEffect)(()=>(i=t,()=>{i=null}),[]),(0,r.jsx)(a.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},66912:(e,t,n)=>{n.d(t,{M:()=>i});var r=n(54568),s=n(72902),a=n(59666);function i(e){let{className:t,onClick:n,as:i="span"}=e;return(0,r.jsx)(i,{className:(0,s.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",n&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:n,children:(0,r.jsx)(a.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},74172:(e,t,n)=>{n.d(t,{Ou:()=>a,Tk:()=>l,jT:()=>i});var r=n(4211),s=n(50848);let a=(0,r.v)()((0,s.Zr)(e=>({pendingMessages:{},addPendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[...e.pendingMessages[t]||[],n]}}))},clearPendingMessages:t=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[]}}))},removePendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:(e.pendingMessages[t]||[]).filter(e=>e.uuid!==n)}}))}}),{name:"session-pending-messages",storage:(0,s.KU)(()=>sessionStorage)})),i=()=>a(e=>e.addPendingMessage),o=[],l=e=>a(t=>{var n;return null!=(n=t.pendingMessages[e])?n:o})},76737:(e,t,n)=>{n.d(t,{Si:()=>z,i1:()=>U,vV:()=>R,fU:()=>L});var r=n(2348),s=n(54568),a=n(44894),i=n(40925),o=n(33509),l=n(96614),u=n(86545),c=n(2327),d=n(74813),m=n(1613),f=n(64328),g=n(35984),p=n(59922),h=n(67453),v=n(16178),y=n(39613),b=n(80688),_=n(68067),x=n(30574),S=n(79289),k=n(4869),w=n(7620),M=n(59666),C=n(10369),P=n(51287),T=n(91754),j=n(47463);let A=[{matcher:e=>e.message.toLowerCase().includes("failed to fetch")||e.message.toLowerCase().includes("load failed")||e.message.toLowerCase().includes("networkerror"),createMessage:()=>(0,s.jsx)(M.A,{defaultMessage:"Upload failed due to a network issue. Check your internet connection and try again.",id:"1bxKaj0pKU"})},{matcher:e=>e.message.includes("password protected")||e.message.includes("document_password_protected"),createMessage:()=>(0,s.jsx)(M.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})},{matcher:e=>e.message.includes("https://docs.claude.com/en/docs/build-with-claude/files#error-handling"),createMessage:()=>(0,s.jsx)(M.A,{defaultMessage:"The title of the document you uploaded is too long, or includes forbidden characters (<, >, :, “, |, ?, *, \\, /, or unicode characters 0-31)",id:"vC8OetMVHP"})},{matcher:e=>e.message.includes("not supported"),extractor:e=>[...new Set(e.map(e=>(0,a.QC)(e.file.name)))],createMessage:e=>(0,s.jsx)(M.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:e.length,formats:(0,s.jsx)(T.dT,{type:"conjunction",value:e})}})},{matcher:e=>e.message.includes("exceeds maximum size")||e.message.includes("File too large"),extractor:e=>e.map(e=>({file_type:e.file.type,file_size:e.file.size})),createMessage:()=>{let e=Math.floor(i.gZ/1048576);return(0,s.jsx)(M.A,{defaultMessage:"You may not upload files larger than {sizeLimit}mb.",id:"nW3gZD88Va",values:{sizeLimit:e}})},trackAnalytics:(e,t)=>{e.track({event_key:"file_upload_too_large",large_files:t})}}];function E(){let e=(0,r._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return E=function(){return e},e}function z(e){let{syncSourceCount:t,files:n,setFiles:r,numExistingConversationFiles:o,attachments:c,setAttachments:d,numExistingConversationAttachments:m,detectSameAttachment:f,selectedModel:p,blobFileUploadsEnabled:v,conversationUuid:y,wiggleEnabled:b}=e,{addError:_}=(0,g.Y)(),k=(0,l.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:o,numExistingConversationAttachments:l,numExistingConversationFiles:c,selectedModel:d,blobFileUploadsEnabled:m,conversationUuid:f,wiggleEnabled:g}=e,p=(0,C.A)(),{modelConfig:v}=(0,u.fC)(d),y=v.image_in,[b,_,k,P]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:a,numExistingConversationFiles:o,selectedModel:l,blobFileUploadsEnabled:c,conversationUuid:d,wiggleEnabled:m}=e,{modelConfig:f}=(0,u.fC)(l),g=f.image_in,p=U()&&f.pdf_in,{isUploading:h,setIsUploading:v,handleError:y,handleUpload:b}=R({imagesEnabled:g,blobFileUploadsEnabled:c,onUploadComplete:n,rasterizePdfUploadsEnabled:p,conversationUuid:d,wiggleEnabled:m}),_=(0,w.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:l=0,showError:u=!0}=e;if(l+n.length+(r.length+a.length+t)>i.XA.maxTotalUploadsPerMessage)return u&&y((0,s.jsx)(M.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:i.XA.maxTotalUploadsPerMessage}})),!1;let d=o||0,{messageFileCount:m}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,r=0,s=0;for(let a of e){let{willBecomeMessageFile:e,category:o}=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"";return i.h8.includes(r)?{category:"image",willBecomeMessageFile:!!n.imagesEnabled}:i.Ap.includes(r)?{category:"pdf",willBecomeMessageFile:!!n.rasterizePdfUploadsEnabled,requiresFeatureGate:"janus_claude-ai"}:i.PC.includes(r)?{category:"out-of-context",willBecomeMessageFile:!!n.blobFileUploadsEnabled,requiresFeatureGate:"ooc_attachments"}:i.BA.includes(r)?{category:"text",willBecomeMessageFile:!1}:i.pH.includes(r)?{category:"document",willBecomeMessageFile:!1}:{category:"unsupported",willBecomeMessageFile:!1}}(a,t);"unsupported"===o?s++:e?n++:r++}return{messageFileCount:n,messageAttachmentCount:r,unsupportedCount:s}}(n,{blobFileUploadsEnabled:c,imagesEnabled:g,rasterizePdfUploadsEnabled:p});if(d+m>i.XA.maxFilesPerConversation){var f;return u&&y((f=i.XA.maxFilesPerConversation,(0,s.jsx)(M.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:f,suggestion:d<f?(0,s.jsx)(M.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,s.jsx)(M.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}}))),!1}return!0},[r,a,t,y,c,o,g,p]);return[h,v,_,(0,w.useCallback)(async e=>{_({newUploads:e})&&await b(e)},[b,_])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:r,numExistingConversationFiles:c,numExistingConversationAttachments:l,selectedModel:d,blobFileUploadsEnabled:m,conversationUuid:f,wiggleEnabled:g}),T=function(e){let{handleUpload:t}=e,n=(0,w.useRef)({ready:0,total:0}),r=(0,w.useCallback)(()=>{n.current={ready:0,total:0}},[]),s=(0,w.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),a=(0,w.useCallback)((e,t)=>{let r=e.length;for(let i=0;i<r;i++){let r=e[i];r.isFile?(n.current.total+=1,r.file(e=>{t.push(e),s(t)})):r.isDirectory&&r.createReader().readEntries(e=>{a(e,t)})}},[s]);return(0,w.useCallback)(e=>{var t;e.preventDefault(),r();let n=null==(t=e.dataTransfer)?void 0:t.items;if(!n)return;let s=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&s.push(t)}a(s,[])},[a,r])}({handleUpload:P}),j=(0,w.useCallback)(async e=>{let t=Array.from(e).map(e=>new File([e],"".concat(Date.now(),"_").concat(e.name),{type:e.type,lastModified:e.lastModified}));await P(t)},[P]),A=(0,w.useCallback)(async e=>{let t=e.target.files;t&&await P(Array.from(t)),e.target.value=""},[P]),E=Math.floor(i.XA.maxFileSize/1048576),z=y?(0,s.jsx)(M.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, {maxSize}mb each)",id:"TGYeob9u0b",values:{maxUploads:i.XA.maxTotalUploadsPerMessage,maxSize:E}}):(0,s.jsx)(M.A,{defaultMessage:"Add content ({maxUploads} max, {maxSize}mb each)\\nAccepts pdf, txt, csv, etc.",id:"rW/kw78ou7",values:{maxUploads:i.XA.maxTotalUploadsPerMessage,maxSize:E}}),L=(0,w.useCallback)(e=>{A(e)},[A]),O=(0,w.useMemo)(()=>({type:"file",accept:g?"":(0,a.cm)({imagesEnabled:y,outOfContextFilesEnabled:m}).join(","),onChange:L,multiple:!0,"aria-label":p.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[y,m,g,L,p]);return[b,_,k,T,j,P,(0,s.jsx)(h.Tooltip,{className:"text-center",tooltipContent:z,children:(0,s.jsxs)(I,{children:[(0,s.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...O}),b?(0,s.jsx)(x.N,{className:"animate-spin",size:18}):(0,s.jsx)(S.x,{size:18,weight:"light"})]})},"upload-tooltip"),O]}({syncSourceCount:t,onUploadComplete:(0,w.useCallback)(async(e,t)=>{if(f&&e.find(e=>f(e.extracted_content)))return void _((0,s.jsx)(M.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"}));d(t=>[...t,...e]),r(e=>[...e,...t]),await Promise.resolve()},[f,_,d,r]),existingAttachments:c,existingFiles:n,numExistingConversationAttachments:m,numExistingConversationFiles:o,selectedModel:null!=p?p:k,blobFileUploadsEnabled:v,conversationUuid:y,wiggleEnabled:b})}let L=()=>{let e=(0,m.mn)(),t=(0,k.useQueryClient)();return async(n,r,s)=>{let a=new FormData;a.append("file",n);let i=s?"/api/organizations/".concat(r,"/projects/").concat(s,"/upload"):"/api/".concat(r,"/upload"),o=await e(i,{method:"POST",body:a}),l=await o.json();if(o.ok)return s&&t.invalidateQueries({queryKey:[b.qz,{orgUuid:r,projectUuid:s}]}),l;throw(0,v.a5)({status:o.status,response:l,fallbackMessage:"File upload failed",headers:o.headers,endpoint:i,method:"POST"})}},R=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:r,rasterizePdfUploadsEnabled:a,onUploadComplete:l,onError:u,projectUuid:m,conversationUuid:p,wiggleEnabled:h}=e,{activeOrganization:b}=(0,f.YL)(),_=null!=(t=null==b?void 0:b.uuid)?t:"",[x]=(0,c.d)(),S=p||x,[k,C]=(0,w.useState)(!1),{addError:T}=(0,g.Y)(),E=(()=>{let{addError:e}=(0,g.Y)();return(0,w.useCallback)((t,n)=>{if(t instanceof v.LG){if("rate_limit_error"===t.type)return void e((0,s.jsxs)("p",{children:[(0,s.jsx)(M.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,s.jsx)(j.W,{})]}),{error:t});if("document_password_protected"===t.errorCode)return void e((0,s.jsx)("p",{children:(0,s.jsx)(M.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}),{error:t})}if(t instanceof v.LG&&"Image is too large"===t.message)return void e((0,s.jsx)("p",{children:(0,s.jsx)(M.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,s.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}),{error:t});e((0,s.jsx)("p",{children:(0,s.jsx)(M.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}),{error:t})},[e])})(),z=(0,w.useCallback)(e=>{C(!1),T(e,{errorContext:{tags:{source:"file_upload"}}}),u&&u()},[T,u,C]),L=(0,d.st)(),R=(0,w.useCallback)(async(e,t)=>{C(!0);try{if(!_)throw Error("Organization not loaded. Please try again.");let u=(0,o.e)(),c=(0,o.O)(e),d=function(e){let{orgUuid:t,projectUuid:n,conversationUuid:r,imagesEnabled:s,rasterizePdfUploadsEnabled:a,blobFileUploadsEnabled:o,wiggleEnabled:l}=e;return{orgUuid:t,projectUuid:n,conversationUuid:r,modelConfig:{image_in:s,pdf_in:a},featureGates:{janus_claude_ai:a,ooc_attachments:o,use_canvas_resize:!0,wiggleEnabled:l},limits:i.XA}}({orgUuid:_,projectUuid:m,conversationUuid:S,imagesEnabled:n,rasterizePdfUploadsEnabled:a,blobFileUploadsEnabled:r,wiggleEnabled:h}),f=await u.processFiles(c,d),{attachments:g,files:p,errors:v}=function(e){let t=[],n=[],r=[];for(let r of e.successful){let e=r.data;"attachment"===r.type?"extracted_content"in e&&t.push(e):"file_kind"in e&&n.push(e)}for(let t of e.failed)r.push({file:t.file,error:t.error});return{attachments:t,files:n,errors:r}}(f);if(function(e,t,n){if(0===e.length)return!1;for(let r of A){let s=e.filter(e=>r.matcher(e.error));if(s.length>0){let e=r.extractor?r.extractor(s):s;return r.trackAnalytics&&r.trackAnalytics(n,e),t(r.createMessage(e)),!0}}for(let n of e)if(n.error instanceof P.o)return t((0,P.B)(n.error)),!0;return e.forEach(e=>t(e.error.message)),!0}(v,z,L))return;let b=function(e,t,n){if(void 0===t||0===e.length)return e;let r=0,a=[];for(let i of e){if((r+=new Blob([i.extracted_content]).size/y.t2)>t)return n((0,s.jsx)(M.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:i.file_name}})),[];a.push(i)}return a}(g,t,z);if(0===b.length&&g.length>0)return;(b.length>0||p.length>0)&&await l(b,p)}catch(t){if(function(e,t){return e instanceof Error?(e.isRateLimit?t((0,s.jsx)(M.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"})):413===e.statusCode||"file_too_large"===e.errorType?t((0,s.jsx)(M.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"})):"extraction_failed"===e.errorType?t((0,s.jsx)(M.A,{defaultMessage:"The file format may not be supported or the file may be corrupted.",id:"CvPTXPZIw8"})):t((0,s.jsx)(M.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0):(t((0,s.jsx)(M.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"})),!0)}(t,z))return;let e="file";t instanceof Error&&t.message.includes("image")&&(e="image"),E(t,e)}finally{C(!1)}},[r,l,n,S,z,E,_,L,a,m,h]);return{isUploading:k,setIsUploading:C,handleError:z,handleUpload:R}},I=p.J.label(E()),U=()=>(0,_.fS)("janus_claude-ai")},86141:(e,t,n)=>{n.d(t,{EF:()=>f,NY:()=>d,Ql:()=>p,VA:()=>g,qJ:()=>m});var r=n(1613),s=n(64328);n(39613);var a=n(80688),i=n(2e3),o=n(4869),l=n(7620),u=n(22167),c=n(91958);let d=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,i=!!(t&&e.length>0),o=(0,l.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),c=(0,l.useMemo)(()=>({queryKey:e.map(e=>[a.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:i,refetchInterval:e=>!!(e.state.data&&(0,u.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[i,n,e]);return(0,r._i)(o,c)},m=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,u.z3)(e.data)),f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,s.YL)(),l=null==t?void 0:t.uuid,d=null==n?void 0:n.uuid,m=(0,o.useQueryClient)(),f=(0,u.eL)();return(0,r.L2)(()=>"/api/organizations/".concat(d,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,s,o,u=arguments.length,c=Array(u),f=0;f<u;f++)c[f]=arguments[f];let[g]=c;m.setQueryData([a.GC,{orgUuid:d,syncSourceUuid:g.uuid}],g),g.type===i.v8.GDRIVE&&g.config.uri&&(null==(t=g.status)?void 0:t.extra)&&(null==(n=g.status)?void 0:n.current_size_bytes)&&m.setQueryData([a.QB,{accountUuid:l,orgUuid:d,documentId:g.config.uri}],{uri:"drive:///".concat(g.config.uri),title:null==(s=g.status)?void 0:s.extra,size:null==(o=g.status)?void 0:o.current_size_bytes}),null==(r=e.onSuccess)||r.call(e,...c)},onError:function(){for(var t,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];null==(t=e.onError)||t.call(e,...r);let[a,o]=r;f(a,o),o.sync_source_type===i.v8.GDRIVE&&(0,c.D8)(o.sync_source_config.uri)}})},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,i=(0,o.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];let[l]=s;i.setQueryData([a.GC,{orgUuid:n,syncSourceUuid:l.uuid}],l),null==(t=e.onSuccess)||t.call(e,...s)}})},p=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},90370:(e,t,n)=>{n.d(t,{_A:()=>U,oM:()=>I});var r=n(54568),s=n(76737),a=n(96769),i=n(44894),o=n(3971),l=n(52135),u=n(34003),c=n(74813),d=n(1613),m=n(79151),f=n(16178),g=n(7620),p=n(4211),h=n(42469),v=n(86141),y=n(94028),b=n(24443),_=n(93714),x=n(45538),S=n(64328),k=n(35984),w=n(10665),M=n(4114),C=n(59074),P=n(55442),T=n(54667),j=n(35580),A=n(90458),E=n(55188),z=n(88775),L=n(68067);let R=g.createContext({transitionFiles:[],isAtMaxNumUploads:!1,model:"",isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),wiggleEnabled:!1,uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0,dynamicAction:()=>void 0}),I=()=>g.useContext(R),U=e=>{var t,n,I,U,O,F,D;let{onSend:N,willRedirectOnSubmit:Y,onCreate:q,onSessionCreate:K,onStopSampling:Q,children:G,chatType:B}=e,V="conversation"in e,W=V?e.conversation:void 0,X="projectUuid"in e?e.projectUuid:void 0,J=null!=(n=null==W?void 0:W.id)?n:void 0===X?"new-conversation":"".concat(X,":conversation"),Z=(0,m.d)("shrew"),H=(0,L.fS)("v2_prompt_storage"),{store:$,unsubscribe:ee}=(0,g.useMemo)(()=>(0,T.E)({enableV2:H,conversationId:J,storage:Z}),[J,H,Z]);(0,g.useEffect)(()=>()=>{null==ee||ee()},[ee]);let{incognitoModeEnabled:et}=(0,E.S)(),en=(0,g.useRef)(null),{track:er}=(0,c.st)();(0,g.useEffect)(()=>{(0,$.getState().setPromptInputRef)(en)},[$]);let{markMessageSent:es}=(0,P.B)(),ea=(0,g.useCallback)(()=>{V&&Q&&Q()},[Q,V]);(e=>{let t=(0,g.useCallback)(t=>{if(e&&!(e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")))(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&(e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))})(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,g.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])})(en.current);let{attachments:ei,files:eo,syncSourceUuids:el}=(0,p.P)($,(0,h.k)(e=>({attachments:e.attachments,files:e.files,syncSourceUuids:e.syncSourceUuids}))),{setAttachments:eu,setFiles:ec,setSyncSourceUuids:ed}=(0,g.useMemo)(()=>{let e=$.getState();return{setAttachments:e.setAttachments,setFiles:e.setFiles,setSyncSourceUuids:e.setSyncSourceUuids}},[$]),em=(0,v.NY)(el),ef=(0,v.qJ)(em),eg=(0,d.B7)(em),ep=ei.length+eo.length+el.length>=i.XA.maxTotalUploadsPerMessage,{isModelSelectorOpen:eh,isSending:ev,isUploadingDriveSync:ey,isUploadingGithubSync:eb,personalizedStyle:e_,includeProfilePreferences:ex,currentCompassTask:eS}=(0,p.P)($,(0,h.k)(e=>({isModelSelectorOpen:e.isModelSelectorOpen,isSending:e.isSending,isUploadingDriveSync:e.isUploadingDriveSync,isUploadingGithubSync:e.isUploadingGithubSync,personalizedStyle:e.personalizedStyle,includeProfilePreferences:e.includeProfilePreferences,currentCompassTask:e.currentCompassTask}))),{setIsModelSelectorOpen:ek,setIsSending:ew,setIsUploadingDriveSync:eM,setIsUploadingGithubSync:eC,setPersonalizedStyle:eP,setIncludeProfilePreferences:eT,setCurrentCompassTask:ej,setStoreModel:eA,setStoreConversation:eE,setStorePendingConversationSettings:ez,_setProjectUuid:eL}=(0,g.useMemo)(()=>{let e=$.getState();return{setIsModelSelectorOpen:e.setIsModelSelectorOpen,setIsSending:e.setIsSending,setIsUploadingDriveSync:e.setIsUploadingDriveSync,setIsUploadingGithubSync:e.setIsUploadingGithubSync,setPersonalizedStyle:e.setPersonalizedStyle,setIncludeProfilePreferences:e.setIncludeProfilePreferences,setCurrentCompassTask:e.setCurrentCompassTask,setStoreModel:e.setModel,setStoreConversation:e.setConversation,setStorePendingConversationSettings:e.setPendingConversationSettings,_setProjectUuid:e.setProjectUuid}},[$]),[eR,eI]=g.useState(),{stickyModelPreference:eU}=(0,l.F)(),eO=null!=(O=null!=(U=null!=(I=null==W?void 0:W.model)?I:eR)?U:eU)?O:void 0,eF=(0,w.vP)("enabled_mcp_tools"),eD=(0,g.useRef)(eF);eD.current=eF;let[eN,eY]=g.useState(),eq=(0,g.useMemo)(()=>({}),[]);(0,g.useLayoutEffect)(()=>{let e=$.getState();e.model!==eO&&eA(eO),e.conversation!==W&&eE(W);let t=null!=eN?eN:eq,n=e.pendingConversationSettings,r=!n||0===Object.keys(n).length,s=!eN||0===Object.keys(eN).length;r&&s||n===t||ez(t)},[$,W,eO,eN,eq,eA,eE,ez]);let eK=(0,g.useCallback)(e=>{eY(t=>{let n={...t,...e};return ez(n),n})},[ez]);(0,g.useEffect)(()=>{"yukon_gold"===B&&eK({enabled_yukon_gold:!0})},[B,eK]);let eQ=(0,p.P)($,e=>e.projectUuid),eG=(0,b.Ah)(),eB=(0,x.kj)(),{mutate:eV}=(0,x.my)(),{mutate:eW}=(0,y.nI)(),{data:eX}=(0,x.xQ)(eQ),eJ=(0,g.useCallback)(e=>{eL(e),eB?e&&eV&&eV({projectUuid:e}):eG&&e&&eW&&eW({project_uuid:e})},[eG,eV,eW,eL,eB]),eZ=(0,_.ks)(eQ),[eH,e$]=g.useState(),{storedStyle:e0,defaultStyle:e1}=(0,M.p)();(0,g.useEffect)(()=>{let e=null!=e0?e0:e1;!e_&&e&&eP(e)},[e0,e1,e_,eP]);let e2=(0,g.useRef)(X);(0,g.useEffect)(()=>{(e2.current!==X||void 0===eQ&&void 0!==X)&&(eQ!==X&&eJ(X),e2.current=X)},[X,eQ,eJ]);let e6="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null,e5=null==W?void 0:W.id,e4=(0,A.Z)(e5);(0,g.useEffect)(()=>{e$(void 0),ew(!1)},[e5,ew]),(0,g.useEffect)(()=>{null==e6||e6(e_)},[e_,e6]);let e3=(0,g.useCallback)(async()=>{let e=$.getState().getPrompt();if(!en.current||""===e.trim()&&0===ei.length&&0===eo.length&&0===el.length)return;let t=$.getState().tipTapEditorState,n=(0,o.Oe)(t),{multipleNewlineCount:r,singleNewlineCount:s}=(0,a.Dn)(e);Y&&e$([...eo]),$.getState().clearAllInput(),$.getState().setPrompt("",{forceUpdateTiptap:!1}),Y?en.current.setEditable(!1):en.current.setContent(""),ew(!0);try{es();let t=!!$.getState().pendingConversationSettings.enabled_yukon_gold,a=V?e4:t;if(er({event_key:"claudeai.message.sent",conversation_uuid:J,model:eO,has_attachments:ei.length>0,has_files:eo.length>0,has_sync_sources:el.length>0,message_length:e.length,is_new_conversation:!V,has_personalized_style:!!e_,include_profile_preferences:ex,is_incognito:et,is_yukon_gold:a,text_formatting:n,multiple_newline_count:r,single_newline_count:s}),V&&N)await N({prompt:e,attachments:ei,files:eo,syncSources:eg,personalized_style:e_}),ew(!1),e$(void 0);else if(t&&K){var i,l;let t=(l=null!=(i=eD.current)?i:{},Object.fromEntries(Array.from(new Set((0,j._b)(!1,l).filter(e=>"mcp_server_uuid"in e).map(e=>e.mcp_server_uuid))).map(e=>(0,j.et)(e)).filter(Boolean).filter(e=>(0,j.pH)(e.uuid)).map(e=>[e.uuid,{type:"http",url:e.url,headers:{"X-MCP-Server-ID":e.uuid}}])));await K(e,t,eO)}else{let t=$.getState().pendingConversationSettings,n=eQ&&eX&&!V?{...eX,...t}:t;await q({prompt:e,attachments:ei,files:eo,syncSources:eg,model:eO,project_uuid:eQ,personalized_style:e_,include_conversation_preferences:ex,is_temporary:et,...n})}}catch(t){if($.getState().setPrompt(e,{forceUpdateTiptap:!0}),eu(ei),ec(eo),ed(el),en.current.setEditable(!0),ew(!1),e$(void 0),t instanceof f.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,C.T)();else throw t}},[$,J,ei,eo,el,Y,ew,es,er,eO,ex,et,e_,V,e4,N,K,eg,q,eQ,eX,eu,ec,ed]),e8=(0,g.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&V){ew(!0);try{N&&(await N({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:e_}),ew(!1))}catch(e){if(e instanceof f.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,C.T)();else throw e;ew(!1)}}},[V,N,e_,ew]),{streamImprovement:e7,isStreaming:e9}=function(){let{activeOrganization:e}=(0,S.YL)(),[t,n]=(0,g.useState)(!1),[r,s]=(0,g.useState)(null),a=(0,g.useRef)(null),{addError:i}=(0,k.Y)(),o=(0,g.useCallback)(async(t,r,o,l)=>{a.current&&a.current.abort();let u=new AbortController;a.current=u,n(!0),s(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,m,f;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),s=new TextDecoder;if(!n)throw Error("No response body");let a="",i="",l=!1;for(;!l;){let e=await n.read();if(e.done){l=!0;break}let t=e.value,u=(a+=s.decode(t,{stream:!0})).split("\n");for(let e of(a=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(m=e.delta)?void 0:m.text)&&(i+=e.delta.text,r(e.delta.text));break;case"message_stop":o(e.improved_prompt||i);break;case"error":throw Error((null==(f=e.error)?void 0:f.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));s(e),null==l||l(e),i("Failed to improve prompt.",{error:e})}finally{n(!1),a.current===u&&(a.current=null)}},[null==e?void 0:e.uuid,i]);return(0,g.useEffect)(()=>()=>{a.current&&a.current.abort()},[]),{streamImprovement:o,isStreaming:t,error:r}}(),te=(0,g.useCallback)(async()=>{var e,t,n,r;let s=$.getState().getPrompt();if(!s.trim())return;null==(e=en.current)||e.setEditable(!1);let a="",i=!1;try{await e7({conversation_uuid:(null==W?void 0:W.id)||"new-conversation",prompt:s},e=>{var t,n,r;i||(i=!0,$.getState().setPrompt(""),null==(r=en.current)||r.setContent("")),a+=e,$.getState().setPrompt(a,{forceUpdateTiptap:!1}),null==(t=en.current)||t.setContent(a),null==(n=en.current)||n.scrollToEnd()},e=>{var t;$.getState().setPrompt(e),null==(t=en.current)||t.setContent(e)},e=>{var t;$.getState().setPrompt(s),null==(t=en.current)||t.setContent(s)})}catch(e){$.getState().setPrompt(s),null==(t=en.current)||t.setContent(s)}finally{null==(n=en.current)||n.setEditable(!0),null==(r=en.current)||r.focus()}},[$,e7,null==W?void 0:W.id]),tt=(0,g.useCallback)(async e=>{let t=$.getState().getPrompt();if(eI(e),eA(e),V){ew(!0);try{var n;await q({prompt:t,attachments:ei,files:eo,syncSources:eg,model:e,project_uuid:eQ,create_mode:null==W||null==(n=W.conversationSettings)?void 0:n.create_mode,...eN})}finally{ew(!1)}}},[$,eA,V,ew,q,ei,eo,eg,eQ,null==W||null==(t=W.conversationSettings)?void 0:t.create_mode,eN]),tn=(0,g.useCallback)(()=>{var e;return null==(e=en.current)?void 0:e.focus()},[en]),[tr,ts]=g.useState(!1),ta=(0,i.cV)(),ti=(0,u.u9)(),[to,tl,tu,tc,td,tm,tf,tg]=(0,s.Si)({syncSourceCount:el.length,attachments:ei,setAttachments:eu,numExistingConversationAttachments:null!=(F=null==W?void 0:W.attachmentsSoFar)?F:0,files:eo,setFiles:ec,numExistingConversationFiles:null!=(D=null==W?void 0:W.files.length)?D:0,detectSameAttachment:()=>!1,selectedModel:eO,conversationUuid:null==W?void 0:W.id,blobFileUploadsEnabled:ta,wiggleEnabled:null!=ti&&ti}),tp=ei.length+eo.length,th=el.length,tv=to||ey||eb,ty=tp>0||th>0||tv,tb=(0,g.useCallback)(e=>{switch(e.action){case"focusInput":tn();break;case"improvePrompt":te();break;case"sendMessage":e3();break;case"setAttachments":eu(e.value);break;case"setCurrentCompassTask":ej(e.value);break;case"setFiles":ec(e.value);break;case"setHasBlockingWarning":ts(e.value);break;case"setIncludeProfilePreferences":eT(e.value);break;case"setIsModelSelectorOpen":ek(e.value);break;case"setIsUploadingDriveSync":eM(e.value);break;case"setIsUploadingFile":tl(e.value);break;case"setIsUploadingGithubSync":eC(e.value);break;case"setModel":tt(e.value);break;case"setPendingConversationSettings":eK(e.value);break;case"setPersonalizedStyle":eP(e.value);break;case"setProjectUuid":eJ(e.value);break;case"setPrompt":{var t;let n=e.value;$.getState().setPrompt(null!=(t=null==n?void 0:n.text)?t:"",null==n?void 0:n.options)}break;case"setSyncSourceUuids":ed(e.value);break;case"setTipTapEditorState":$.getState().setTipTapEditorJSON(e.value);break;case"stopSampling":ea()}},[tn,te,e3,eu,ej,ec,ts,eT,ek,eM,tl,eC,tt,eK,eP,eJ,ed,ea,$]),t_=(0,g.useMemo)(()=>{var t;return{files:e.willRedirectOnSubmit&&ev?null!=eH?eH:[]:eo,isAtMaxNumUploads:ep,isUploadingDriveSync:ey,isUploadingGithubSync:eb,model:eO,isChatSyncing:ef,personalizedStyle:e_,isProjectSyncing:eZ,isNewConversation:void 0===W||0===W.messagesSoFar,isProjectLocked:void 0!==X||void 0!==W,isSending:ev,setModel:tt,setProjectUuid:eJ,sendMessage:e3,sendTransparentMessage:e8,improvePrompt:te,isImprovingPrompt:e9,stopSampling:ea,conversation:W,focusInput:tn,promptInputRef:en,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:tr,setHasBlockingWarning:ts,setPersonalizedStyle:eP,setIsUploadingDriveSync:eM,setIsUploadingGithubSync:eC,includeProfilePreferences:ex,setIncludeProfilePreferences:eT,pendingConversationSettings:eN,setPendingConversationSettings:eK,isUploadingFile:to,setIsUploadingFile:tl,validateMaxUploadLimit:tu,onDrop:tc,onPasteFiles:td,handleUpload:tm,uploadInputProps:tg,hasAttachments:ty,isModelSelectorOpen:eh,setIsModelSelectorOpen:ek,currentCompassTask:eS,setCurrentCompassTask:ej,dynamicAction:tb,wiggleEnabled:ti}},[W,eo,tn,X,tr,ex,ep,ef,eZ,ev,ey,eb,eO,e_,eJ,e.willRedirectOnSubmit,e3,e8,te,e9,tt,eN,eK,ea,eH,to,tl,tu,tc,td,tm,tg,ty,eh,ek,eS,ej,eT,eM,eC,eP,tb,ti]);return(0,r.jsx)(z.jM,{value:$,children:(0,r.jsx)(R.Provider,{value:t_,children:G})})}},90458:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(19736),s=n(17421);function a(e){var t;let n=(0,s.Ly)(),a=(0,r.$z)(null!=e?e:null);return!!e&&(n?!!(null==(t=a.data)?void 0:t.session_id):e.startsWith("session_"))}},93714:(e,t,n)=>{n.d(t,{CO:()=>m,M3:()=>u,bG:()=>c,ks:()=>g,pz:()=>l,z_:()=>d});var r=n(1613),s=n(64328),a=n(80688),i=n(4869),o=n(22167);let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,s.YL)(),a=null==n?void 0:n.uuid,i=f(),l=(0,o.eL)();return(0,r.L2)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,s=Array(r),a=0;a<r;a++)s[a]=arguments[a];i(e),null==(n=t.onSuccess)||n.call(t,...s)},onError:function(){for(var e,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];null==(e=t.onError)||e.call(t,...r);let[a,i]=r;l(a,i)}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,s.YL)(),a=null==n?void 0:n.uuid,i=f();return(0,r.L2)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,s=Array(r),a=0;a<r;a++)s[a]=arguments[a];i(e),null==(n=t.onSuccess)||n.call(t,...s)}})},c=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,i=f();return(0,r.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[a.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{i(e)}})},d=e=>{let{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,i=f();return(0,r.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[a.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{i(e)}})},m=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:l}=(0,s.YL)(),u=null==l?void 0:l.uuid,c=(0,i.useQueryClient)(),d=!!(l&&e&&n),{data:m,isLoading:f}=(0,r.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[a.LV,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(o.z3))?5e3:3e5},structuralSharing:(t,n)=>{let r=void 0!==t&&t.some(o.z3),s=void 0!==n&&n.some(o.z3);return r&&!s&&c.invalidateQueries({queryKey:[a.qz,{orgUuid:u,projectUuid:e}]}),n}});return{data:m,isLoading:!!d&&f}},f=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=(0,i.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[a.LV,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[a._G,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[a.qz,{orgUuid:t,projectUuid:e}]})}},g=e=>{let{data:t}=m(e);return!!(null==t?void 0:t.some(o.z3))}},96769:(e,t,n)=>{function r(e){return e.replace(/(^|\n)(\s?)•(\s?)/g,"$1$2- ")}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"markdown-document",n=e.indexOf("```");if(-1===n||-1===e.indexOf("```",n+3))return e;let r=[...e.matchAll(/^(\s*)(```+)(.*)$/gm)];if(0===r.length)return e;let s=new Map,a=e=>{let t=s.get(e);return void 0===t&&(t="`".repeat(e),s.set(e,t)),t},i=[];for(let e of r){var o;let[t,n,r,s]=e,a=null!=(o=e.index)?o:0;i.push({index:a,length:t.length,backtickCount:r.length,indent:n,info:s.trim(),depth:0})}let l=[];for(let e=0;e<i.length;e++){let n=i[e];if(""!==n.info){n.depth=l.length,l.push(e);continue}if(0===l.length){n.depth=0,l.push(e);continue}let r=i[l[l.length-1]];if(n.backtickCount<r.backtickCount){n.depth=l.length,l.push(e);continue}let s=!0;if("code-in-markdown"===t&&1===l.length){let t=-1;for(let r=e+1;r<i.length&&""===i[r].info;r++)if(i[r].backtickCount===n.backtickCount){t=r;break}if(-1!==t){for(let e=t+1;e<i.length;e++)if(i[e].backtickCount>=r.backtickCount){s=!1;break}}}s?(n.depth=l.length-1,r.closingFenceIndex=e,l.pop()):(n.depth=l.length,l.push(e))}let u=new Map,c=0;for(let e of i){let t=u.get(e.depth)||3;u.set(e.depth,Math.max(t,e.backtickCount)),c=Math.max(c,e.depth)}for(let e=c-1;e>=0;e--){let t=u.get(e)||3,n=u.get(e+1)||0;n>=t&&u.set(e,n+1)}let d=new Map;for(let e of i){let t=u.get(e.depth)||3;if(t>e.backtickCount&&d.set(e.index,{index:e.index,length:e.length,replacement:"".concat(e.indent).concat(a(t)).concat(e.info)}),void 0!==e.closingFenceIndex){let n=i[e.closingFenceIndex];n.backtickCount!==t&&d.set(n.index,{index:n.index,length:n.length,replacement:"".concat(n.indent).concat(a(t))})}}if(0===d.size)return e;if(1===d.size){let[{index:t,length:n,replacement:r}]=d.values();return e.slice(0,t)+r+e.slice(t+n)}let m=Array.from(d.values()).sort((e,t)=>e.index-t.index),f=[],g=0;for(let{index:t,length:n,replacement:r}of m)f.push(e.slice(g,t)),f.push(r),g=t+n;return f.push(e.slice(g)),f.join("")}function a(e){return e.replace(/\\/g,"\\\\")}n.d(t,{Dn:()=>i,Gm:()=>a,UT:()=>s,tH:()=>r});let i=e=>{let t=e.match(/\n+/g),n=t?t.length:0,r=e.match(/\n{2,}/g),s=r?r.length:0;return{multipleNewlineCount:s,singleNewlineCount:n-s}}}}]);