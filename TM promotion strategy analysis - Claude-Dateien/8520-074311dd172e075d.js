"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8520],{1230:(e,t,r)=>{r.d(t,{c:()=>n});let n=(0,r(4211).v)((e,t)=>({currentRequest:null,setCurrentRequest:t=>e({currentRequest:t}),clearCurrentRequest:()=>{e({currentRequest:null})},acceptElicitation:r=>{let n=t().currentRequest;n&&(n.resolve({action:"accept",data:r}),e({currentRequest:null}))},declineElicitation:()=>{let r=t().currentRequest;r&&(r.resolve({action:"decline"}),e({currentRequest:null}))},cancelElicitation:()=>{let r=t().currentRequest;r&&(r.resolve({action:"cancel"}),e({currentRequest:null}))}}))},7899:(e,t,r)=>{r.d(t,{r:()=>S});var n=r(74813),s=r(64328),i=r(77001),a=r(68067),o=r(56929),c=r(7620),u=r(44007),l=r(96547),d=r(76426),h=r(35580),p=r(97859),m=r(11258),f=r(75284),g=r(26149),v=r(66365),y=r(23670);class C extends Error{constructor(e){super(e||"Authentication error"),this.name="UnauthedError"}}class _{start(){if(this._socket)throw Error("WebSocketClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{this._socket=new WebSocket(this._url,["mcp"]),this._socket.onerror=e=>{var r;let n="error"in e?e.error:Error("WebSocket error: ".concat(JSON.stringify(e)));t(n),null==(r=this.onerror)||r.call(this,n)},this._socket.onopen=()=>{e()},this._socket.onclose=e=>{var t;null==(t=this.onclose)||t.call(this)},this._socket.onmessage=e=>{var t,r,n,s,i;let a,o;try{a=JSON.parse(e.data)}catch(e){null==(r=this.onerror)||r.call(this,e);return}let c=a;if("mcp_unauthorized"===c.error_code){null==(n=this.onAuthError)||n.call(this,new C(c.error||"Authentication required"));return}try{o=y.OR.parse(a)}catch(e){null==(s=this.onerror)||s.call(this,e);return}let u=o;if("connected"===u.method&&u.params){null==(i=this.onConnect)||i.call(this,u.params.used_auth);return}null==(t=this.onmessage)||t.call(this,o)}})}async close(){var e;null==(e=this._socket)||e.close()}send(e){return new Promise((t,r)=>{var n;if(!this._socket)return void r(Error("Not connected"));null==(n=this._socket)||n.send(JSON.stringify(e)),t()})}constructor(e){this._url=e}}class w{async refreshClient(){return this.cachedClient=await this.getClient(),this.cachedClient}disconnectIfNoOngoingRequests(){this.cachedClient&&0===this.inflightRequestCount&&(this.cachedClient.close(),this.cachedClient=void 0)}clearTimeout(){this.debouncedDisconnectTimeout&&(clearTimeout(this.debouncedDisconnectTimeout),this.debouncedDisconnectTimeout=null)}beforeRequest(){this.inflightRequestCount++,this.clearTimeout()}afterRequest(){this.inflightRequestCount--,this.clearTimeout(),null!==this.disconnectTimeout&&(this.debouncedDisconnectTimeout=setTimeout(()=>{this.disconnectIfNoOngoingRequests()},this.disconnectTimeout))}async useClient(e){this.beforeRequest();try{return await e(await this.refreshClient())}finally{this.afterRequest()}}async initialize(){await this.refreshClient()}async connect(e){throw await Promise.resolve(),Error("Cannot call connect on a wrapped client")}async close(){var e;return null==(e=this.cachedClient)?void 0:e.close()}async registerCapabilities(e){return(await this.refreshClient()).registerCapabilities(e)}getServerCapabilities(){var e;return null==(e=this.cachedClient)?void 0:e.getServerCapabilities()}getServerVersion(){var e;return null==(e=this.cachedClient)?void 0:e.getServerVersion()}getInstructions(){var e;return null==(e=this.cachedClient)?void 0:e.getInstructions()}async ping(e){return(await this.refreshClient()).ping(e)}async complete(e,t){return this.useClient(r=>r.complete(e,t))}async setLoggingLevel(e,t){return this.useClient(r=>r.setLoggingLevel(e,t))}async getPrompt(e,t){return this.useClient(r=>r.getPrompt(e,t))}async listPrompts(e,t){return this.useClient(r=>r.listPrompts(e,t))}async listResources(e,t){return this.useClient(r=>r.listResources(e,t))}async listResourceTemplates(e,t){return this.useClient(r=>r.listResourceTemplates(e,t))}async readResource(e,t){return this.useClient(r=>r.readResource(e,t))}async subscribeResource(e,t){return this.useClient(r=>r.subscribeResource(e,t))}async unsubscribeResource(e,t){return this.useClient(r=>r.unsubscribeResource(e,t))}async callTool(e,t,r){return this.useClient(n=>n.callTool(e,t,r))}async listTools(e,t){return this.useClient(r=>r.listTools(e,t))}async sendRootsListChanged(){return this.useClient(e=>e.sendRootsListChanged())}async request(e,t,r){return this.useClient(n=>n.request(e,t,r))}async notification(e){return this.useClient(t=>t.notification(e))}async setRequestHandler(e,t){return(await this.refreshClient()).setRequestHandler(e,t)}async removeRequestHandler(e){return(await this.refreshClient()).removeRequestHandler(e)}async assertCanSetRequestHandler(e){return(await this.refreshClient()).assertCanSetRequestHandler(e)}async setNotificationHandler(e,t){return(await this.refreshClient()).setNotificationHandler(e,t)}async removeNotificationHandler(e){return(await this.refreshClient()).removeNotificationHandler(e)}async assertCapabilityForMethod(e){return(await this.refreshClient()).assertCapabilityForMethod(e)}async assertNotificationCapability(e){return(await this.refreshClient()).assertNotificationCapability(e)}async assertRequestHandlerCapability(e){return(await this.refreshClient()).assertRequestHandlerCapability(e)}get transport(){var e;return null==(e=this.cachedClient)?void 0:e.transport}constructor(e,t,r=null){this.getClient=e,this.cachedClient=t,this.disconnectTimeout=r,this.debouncedDisconnectTimeout=null,this.inflightRequestCount=0}}var b=r(40459);async function k(e,t,r,n){let s=function(){if((0,i.yz)()){if(b.env.NEXT_MCP_WEBSOCKET_PROXY)return b.env.NEXT_MCP_WEBSOCKET_PROXY;let e=b.env.NEXT_PUBLIC_MCP_WEBSOCKET_BACKEND||"http://localhost:8000";if(null==e?void 0:e.startsWith("http"))return e.replace("http","ws");if(null==e?void 0:e.startsWith("ws"))return e.replace("https","wss")}return""}(),a=new _("".concat(s,"/api/ws/organizations/").concat(e,"/mcp/servers/").concat(t,"/"));a.onAuthError=r,a.onConnect=n;let o=(0,f.U)();return await o.connect(a),o}function S(){let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,{track:r}=(0,n.st)(),i=(0,g.c)(),f=function(){let{value:e}=(0,v.useDynamicConfig)("apps_mcp_ws_reconnect_config");return e}(),y=(0,a.fS)("claude_ai_unicode_sanitize_mcp_data"),C=(0,u.p9)(),_=(0,a.fS)("mcp_shadow_comparison");_&&m.Z.getState().setTrackFn(r,Date.now());let b=(0,p.O)(e=>e.serversNeedingWebsocketRetry),{data:S,isLoading:R}=(0,l.eB)(t),T=C?b:S,E=null==f?void 0:f.reconnect_enabled,P=(null==f?void 0:f.disconnect_enabled)&&(null==f?void 0:f.disconnect_timeout)||null,q=(0,c.useCallback)(async(e,t)=>{let r=e=>{(0,o.Cp)(e,{tags:{serverUuid:t.uuid}}),i.trackMcpServerAuthFailure(t.uuid),(0,h.Ug)(t.uuid)},n=e=>{(0,h.n3)(t.uuid,e),(async()=>{let e=await (0,h.xk)(t.uuid);if(!e){(0,o.Cp)(Error("Client is undefined after connection"),{tags:{serverUuid:t.uuid}}),(0,h.Ug)(t.uuid);return}(0,h.MR)(t.uuid,e,y).then(e=>{if(i.trackMcpToolsListed(e.length),_){let r=Date.now(),n=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketTools(t.uuid,{count:e.length,duration_ms:r-n,success:!0})}}).catch(()=>{if(_){let e=Date.now(),r=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketTools(t.uuid,{count:0,duration_ms:e-r,success:!1})}}),(0,h.k$)(t.uuid,e).then(e=>{if(i.trackMcpPromptsListed(e.length),_){let r=Date.now(),n=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketPrompts(t.uuid,{count:e.length,duration_ms:r-n,success:!0})}}).catch(()=>{if(_){let e=Date.now(),r=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketPrompts(t.uuid,{count:0,duration_ms:e-r,success:!1})}}),(0,h.aF)(t.uuid,e).then(e=>{if(i.trackMcpResourcesListed(e.length),_){let r=Date.now(),n=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketResources(t.uuid,{count:e.length,duration_ms:r-n,success:!0})}}).catch(()=>{if(_){let e=Date.now(),r=m.Z.getState().websocketStartTime;m.Z.getState().recordWebsocketResources(t.uuid,{count:0,duration_ms:e-r,success:!1})}})})()};try{let s=async()=>{let s=await (0,h.xk)(t.uuid);if(s&&s&&(null==s?void 0:s.transport)!==void 0)return s;let i=k(e,t.uuid,r,n);(0,h.kc)((0,d.Ic)(t.uuid),i);let a=await i;return(0,h.kc)((0,d.Ic)(t.uuid),a),a},i=await s(),a=E?function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new w(e,t,r)}(async()=>s(),i,P):i;(0,h.kc)(t.uuid,a)}catch(e){i.trackMcpServerConnectionFailed(t.uuid,!1),(0,o.Cp)(e,{tags:{serverUuid:t.uuid}}),(0,h.Ug)(t.uuid)}},[E,P,y,i,_]);(0,c.useEffect)(()=>{(0,h.pZ)(null!=R&&R)},[R]),(0,c.useEffect)(()=>{if(t&&T)for(let e of T)(0,h.s$)(e.uuid)&&((0,h.nd)(e.uuid)&&(0,h.rD)(e),q(t,e))},[T,q,t,C])}},26149:(e,t,r)=>{r.d(t,{c:()=>a});var n=r(74813),s=r(48599),i=r(7620);let a=()=>{let{track:e}=(0,n.st)(),t=(0,s.K)(e),r=(0,i.useCallback)(e=>{t({event_key:"mcp.websocket.authfailure",server_uuid:e})},[t]),a=(0,i.useCallback)((e,r)=>{t({event_key:"mcp.websocket.transport.connection.failed",server_uuid:e,used_authentication:r})},[t]),o=(0,i.useCallback)(e=>{t({event_key:"mcp.tools.listed",tool_count_on_server:e})},[t]);return{trackMcpServerAuthFailure:r,trackMcpServerConnectionFailed:a,trackMcpToolsListed:o,trackMcpResourcesListed:(0,i.useCallback)(e=>{t({event_key:"mcp.resources.listed",resource_count_on_server:e})},[t]),trackMcpPromptsListed:(0,i.useCallback)(e=>{t({event_key:"mcp.prompts.listed",prompt_count_on_server:e})},[t])}}},47606:(e,t,r)=>{r.d(t,{F:()=>l,R:()=>d});var n=r(35984),s=r(77001),i=r(23670),a=r(7620),o=r(35580),c=r(1230),u=r(40459);function l(){return!!(0,s.yz)()&&!u.env.DONT_USE_ELICITATION_MCP}function d(){let e=l(),{clients:t,clientMetadata:r}=(0,o.Ak)(),{setCurrentRequest:s}=(0,c.c)(),{addError:u}=(0,n.Y)();(0,a.useEffect)(()=>{if(e)return t.forEach(e=>{let t=r.get(e);e.setRequestHandler(i.$9,async e=>new Promise((r,n)=>{s({id:"".concat(Date.now(),"-").concat(Math.random()),serverName:t.name,iconType:t.iconType,iconSrc:t.iconSrc,request:e,resolve:r,reject:n})}))}),()=>{e&&t.forEach(e=>{e.removeRequestHandler(i.$9.shape.method.value)})}},[e,t,r,s,u])}},48599:(e,t,r)=>{r.d(t,{K:()=>s});var n=r(7620);function s(e){let t=(0,n.useRef)(e);return(0,n.useEffect)(()=>{t.current=e},[e]),(0,n.useCallback)(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.current(...r)},[])}},75284:(e,t,r)=>{r.d(t,{U:()=>i,q:()=>a});var n=r(23525),s=r(47606);function i(){let e={};return(0,s.F)()&&(e.elicitation={}),new n.K({name:"claude-ai",version:"0.1.0"},{capabilities:e})}async function a(e){let t=i();return await t.connect(e),t}},88520:(e,t,r)=>{r.d(t,{ConnectorsStore:()=>L});var n=r(44007),s=r(24759);function i(){let e=new s._({name:"Elicitation Test",version:"1.0.0"});return e.tool("elicit_inputs","Elicitation test tool",{},async(t,r)=>{let n=await e.server.elicitInput({message:"Please provide inputs for the following fields:",requestedSchema:{type:"object",properties:{name:{title:"Full Name",type:"string",description:"Your full, legal name"},check:{title:"Agree to terms",type:"boolean",description:"A boolean check"},color:{title:"Favorite Color",type:"string",description:"Favorite color (open text)",default:"blue"},email:{title:"Email Address",type:"string",format:"email",description:"Your email address (will be verified, and never shared with anyone else)"},homepage:{type:"string",format:"uri",description:"Homepage / personal site"},birthdate:{title:"Birthdate",type:"string",format:"date",description:"Your date of birth (will never be shared with anyone else)"},integer:{title:"Favorite Integer",type:"integer",description:"Your favorite integer (do not give us your phone number, pin, or other sensitive info)",minimum:1,maximum:100,default:42},number:{title:"Favorite Number",type:"number",description:"Favorite number (there are no wrong answers)",minimum:0,maximum:1e3,default:3.14},petType:{title:"Pet type",type:"string",enum:["cats","dogs","birds","fish","reptiles"],enumNames:["Cats","Dogs","Birds","Fish","Reptiles"],default:"dogs",description:"Your favorite pet type"}},required:["name"]}},{relatedRequestId:r.requestId,timeout:1e8});return{content:[{type:"text",text:"Elicitation result: ".concat(JSON.stringify(n,null,2))}]}}),e.tool("write_poem","Poem writing tool",{},async()=>{let t=await e.server.elicitInput({message:"Please provide inputs for the following fields:",requestedSchema:{type:"object",properties:{subject:{type:"string",title:"Subject",description:"Subject of the poem",enum:["Nature","Love","Adventure","Friendship","Mystery","Fantasy","Humor","Inspiration","Life","Death"]}},required:["subject"]}});if("accept"!==t.action||!(null==t?void 0:t.data))throw Error("Elicitation was not accepted or no data provided");let{subject:r}=t.data;return{content:[{type:"text",text:"TODO: write a poem about ".concat(r)}]}}),e}var a=r(24407);function o(){let e=new s._({name:"Demo",version:"1.0.0"});return e.tool("add",{a:a.z.number(),b:a.z.number()},e=>{let{a:t,b:r}=e;return{content:[{type:"text",text:String(t+r)}]}}),e.tool("greet_person",{name:a.z.string(),greeting:a.z.string()},e=>{let{name:t,greeting:r}=e;return{content:[{type:"text",text:"Message sent to ".concat(t,": ").concat(r," ").concat(t,"!")}]}}),e.resource("Available greetings","greeting://all_greetings",e=>({contents:[{uri:e.href,text:"Hello!"},{uri:e.href,text:"Hi!"},{uri:e.href,text:"Hey!"}]})),e.prompt("ask_to_greet",{name:a.z.string()},e=>{let{name:t}=e;return{messages:[{role:"user",content:{type:"text",text:"Please greet: ".concat(t)}}]}}),e}var c=r(77001),u=r(68067),l=r(86361),d=r(7620),h=r(75284),p=r(35580),m=r(40459);let f=(e,t)=>{let r=(0,u.fS)("claude_ai_unicode_sanitize_mcp_data");(0,d.useEffect)(()=>{!async function(){if((0,c.yz)()&&!m.env.DONT_USE_EXAMPLE_MCP){let n=t(),[s,i]=l.W.createLinkedPair();(async()=>{await n.connect(i)})(),await (0,h.q)(s).then(t=>{(0,p.jh)(e,t),(0,p.fR)(e,t,r),(0,p.BG)(e,t),(0,p.zC)(e,t)})}}()},[r,e,t])};r(42759);var g=r(74813),v=r(35984),y=r(53592),C=r(73356),_=r(48599),w=r(5655);class b{start(){return this._port.onmessage=e=>{var t;null==(t=this.onmessage)||t.call(this,e.data)},this._port.onmessageerror=e=>{var t;null==(t=this.onerror)||t.call(this,Error("MessagePort message error: ".concat(e.data)))},Promise.resolve()}close(){var e;return this._port.close(),null==(e=this.onclose)||e.call(this),Promise.resolve()}send(e){return this._port.postMessage(e),Promise.resolve()}constructor(e){this._port=e}}var k=r(26149);let S=Symbol();async function R(e){let t=new b(e);return(0,h.q)(t)}var T=r(47606),E=r(1613),P=r(64328);r(23670).u9.shape.params;var q=r(27541),M=r(10369),N=r(7899);function L(){return(0,N.r)(),(0,n.oQ)(),!function(){let{addError:e}=(0,v.Y)(),{track:t}=(0,g.st)(),r=(0,_.K)(t),n=(0,k.c)(),s=(0,u.fS)("claude_ai_unicode_sanitize_mcp_data"),[i,a]=(0,d.useState)(S),o=(0,d.useCallback)(t=>{(0,p.dY)(t)||window.claudeAppBindings.connectToMcpServer(t).catch(r=>{C.v.error(C.u.MCP,"Could not connect to MCP server ".concat(t),r),e("Could not connect to MCP server ".concat(t),{error:r})})},[e]);(0,d.useEffect)(()=>{let e=!1;return(async()=>{var t,n;if(!(null==(t=window.claudeAppBindings)?void 0:t.listMcpServers)||!(null==(n=window.claudeAppBindings)?void 0:n.connectToMcpServer))return;i===S&&(0,p.kU)(!0);let s=await window.claudeAppBindings.listMcpServers();if(r({event_key:"mcp.servers.listed",server_count:s.length}),(0,p.kU)(!1),!e)for(let e of s)o(e)})(),()=>{e=!0}},[o,r,i]);let c=(0,d.useCallback)(t=>{if(t.source!==window)return;let{type:i,serverName:o,uuid:c}=t.data;if("mcp-server-auto-reconnect"===i&&o){(0,p.H)(o),a(Symbol());return}if("mcp-server-connected"!==i||!o)return;let[u]=t.ports;R(u).then(e=>{(0,p.jh)(o,e,c),(0,p.fR)(o,e,s).then(e=>{n.trackMcpToolsListed(e.length)}),(0,p.BG)(o,e).then(e=>{n.trackMcpPromptsListed(e.length)}),(0,p.zC)(o,e).then(e=>{n.trackMcpResourcesListed(e.length)}),r({event_key:"mcp.servers.connected",result:"success"})},t=>{e("Could not attach to MCP server ".concat(o),{error:t}),r({event_key:"mcp.servers.connected",result:"failure"})})},[e,r,s,n]);(0,w.M)("message",c),(0,d.useEffect)(()=>{(async()=>{try{var e;let t=await (null===y.Fd||void 0===y.Fd||null==(e=y.Fd.getInstalledExtensionsWithState)?void 0:e.call(y.Fd));null==t||t.forEach(e=>{var t;(0,p.yt)(null!=(t=e.manifest.display_name)?t:e.manifest.name,e)})}catch(e){}})()},[])}(),f("exampleServer",o),f("elicitationServer",i),!function(){let{clients:e}=(0,p.Ak)(),{addError:t}=(0,v.Y)(),{track:r}=(0,g.st)(),{activeOrganization:n}=(0,P.YL)(),s=(0,E.L2)("/api/organizations/".concat(null==n?void 0:n.uuid,"/dust/mcp_messages"),"POST",{enabled:!1,onError:()=>t("MCP sampling failed",{errorContext:{tags:{source:"mcp_sampling"}}})});(0,d.useEffect)(()=>{},[!1,e,s,r])}(),(0,T.R)(),!function(){let e=(0,M.A)(),t=(0,q.useSearchParams)(),{addError:r,addSuccess:n}=(0,v.Y)(),s=t.get("server"),i=t.get("step"),{track:a}=(0,g.st)();(0,d.useEffect)(()=>{let t=(0,p.et)(s||""),o=null==t?void 0:t.name;if(s&&i&&o){switch(a({event_key:"claudeai.mcp.auth.completed",result:i,uuid:s,url:null==t?void 0:t.url}),i){case"success":n(e.formatMessage({defaultMessage:"Successfully connected to {serverName}.",id:"FBlTrm4aTG"},{serverName:o}));break;case"start_error":r(e.formatMessage({defaultMessage:"There was an error connecting to {serverName}. Please check your server URL and make sure your server handles auth correctly.",id:"pwACugMrqk"},{serverName:o}),{messageForLogging:"There was an error connecting to {serverName}. Please check your server URL and make sure your server handles auth correctly."});break;case"end_error":r(e.formatMessage({defaultMessage:"Error connecting to {serverName}. Please confirm that you have permission to access the service, that you’re using the correct credentials, and that your server handles auth correctly.",id:"x0m0Pdvskh"},{serverName:o}),{messageForLogging:"Error connecting to {serverName}. Please confirm that you have permission to access the service, that you’re using the correct credentials, and that your server handles auth correctly."});break;default:r(e.formatMessage({defaultMessage:"An unknown error occurred connecting to {serverName}.",id:"dURdJpCNlT"},{serverName:o}),{messageForLogging:"An unknown error occurred connecting to {serverName}."})}let c=new URL(window.location.href);c.searchParams.delete("server"),c.searchParams.delete("step"),window.history.replaceState({},"",c)}},[s,i,e,r,n,a])}(),null}}}]);